<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Meta‑Explorer — Casual Encounter Probability (Research Tool)</title>
  <style>
    :root{ --bg:#0f1720; --panel:#0b1220; --muted:#96a0b8; --accent:#60a5fa; --accent2:#7c3aed; }
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#071127 0%, #0f1720 100%);font-family:Inter,Segoe UI,Roboto,system-ui;color:#e6eef8}
    .app{display:grid;grid-template-columns:420px 1fr;gap:16px;padding:18px;box-sizing:border-box;min-height:100vh}
    .panel{background:var(--panel);border-radius:12px;padding:14px;box-shadow:0 8px 30px rgba(2,6,23,0.7);overflow:auto}
    h1{margin:0 0 8px 0;font-size:18px}
    label{display:block;font-size:13px;color:#cfe3ff;margin-bottom:6px}
    input[type=number], select, input[type=text]{
        width:100%;
        padding:8px;
        border-radius:8px;
        border:1px solid rgba(255,255,255,0.06);
        background-color:#1e293b; /* improved contrast */
        color:#e6eef8;
    }
    select option{
        background-color:#1e293b; /* option background */
        color:#e6eef8;            /* option text color */
    }
    .small{font-size:12px;color:var(--muted);margin-top:6px}
    .field{margin-bottom:12px}
    .expander{background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:10px;border-radius:8px}
    .help{font-size:12px;color:var(--muted)}
    .tooltip{color:var(--accent);cursor:help;margin-left:6px}
    button{background:linear-gradient(90deg,var(--accent),var(--accent2));border:none;padding:8px 12px;border-radius:8px;color:#fff;font-weight:600;cursor:pointer}

    /* Right fixed visualization panel */
    .vis-wrap{position:fixed;right:18px;top:18px;width:48vw;max-width:760px;height:calc(100vh - 36px);display:flex;flex-direction:column;gap:10px;z-index:999}
    .vis-card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:12px;box-shadow:0 12px 40px rgba(2,6,23,0.6);display:flex;flex-direction:column;align-items:center}
    #heatmapCanvas{width:100%;height:calc(100% - 72px);border-radius:8px}
    .scoreCard{width:100%;display:flex;justify-content:space-between;align-items:center;padding:8px 12px;border-radius:8px;background:rgba(0,0,0,0.25);font-weight:700}
    .legend{font-size:13px;color:var(--muted);}

    /* small responsive adjustments */
    @media(max-width:1100px){ .app{grid-template-columns:1fr; } .vis-wrap{position:static;width:auto;height:auto;} }
</style>

</head>
<body>
  <div class="app">
    <div class="panel" id="controls">
      <h1>Meta‑Explorer Input Panel</h1>
      <div class="small">All scoring rules & tooltips embedded. Use <strong>Export</strong> to save parameter sets for reproducibility.</div>

      <div class="field">
        <label>Age <span class="tooltip" title="Enter numeric age 16–99. Use exact age when available; if using cohort means, enter cohort midpoint.">[?]</span></label>
        <input id="age" type="number" min="16" max="99" value="25">
        <div class="help">Age effect peaks around 20–29; older cohorts reflect historical samples.</div>
      </div>

      <div class="field">
        <label>Gender <span class="tooltip" title="Self‑identified gender from study. Used as a small directional modifier based on meta-analytic summaries.">[?]</span></label>
        <select id="gender"><option value="male">Male</option><option value="female">Female</option><option value="nonbinary">Non‑binary/Other</option></select>
        <div class="help">Default modifiers: male +0.08, female −0.08, nonbinary 0 (editable in scales).</div>
      </div>

      <div class="field">
        <label>Race / Ethnicity <span class="tooltip" title="Self‑reported race from source. Default race modifiers are small and context dependent.">[?]</span></label>
        <select id="race"><option value="none">None / unreported</option><option value="white">White</option><option value="black">Black / African American</option><option value="asian">Asian</option><option value="latino">Latino/Hispanic</option><option value="other">Other</option></select>
        <div class="help">Editing race modifiers is discouraged unless you have study-level justification.</div>
      </div>

      <details>
        <summary style="font-weight:700">Sociosexuality (SOI‑R) — enter or derive</summary>
        <div class="expander">
          <div class="field">
            <label>Direct SOI‑R score (0–9)</label>
            <input id="soi_direct" type="number" min="0" max="9" step="0.1" placeholder="e.g., 4.2">
            <div class="help">SOI‑R components: Behavior, Attitude, Desire. If not available, estimate using checklist.</div>
          </div>
          <div class="field">
            <label>Estimate SOI from these indicators</label>
            <div><input class="soi_cb" type="checkbox" data-val="0.35"> multiple casual partners in last year</div>
            <div><input class="soi_cb" type="checkbox" data-val="0.25"> positive attitude toward one‑night stands</div>
            <div><input class="soi_cb" type="checkbox" data-val="0.25"> willingness for sex without emotional involvement</div>
            <div><input class="soi_cb" type="checkbox" data-val="0.15"> frequently uses dating apps specifically for hookups</div>
            <div class="help">Checked items will be combined into a synthetic SOI (0–1 normalized). See rubric for mapping rules.</div>
          </div>
        </div>
      </details>

      <details>
        <summary style="font-weight:700">Sensation‑Seeking / Impulsivity — enter or derive</summary>
        <div class="expander">
          <div class="field">
            <label>Direct sensation score (0–100)</label>
            <input id="sensation_direct" type="number" min="0" max="100" step="1" placeholder="50">
          </div>
          <div class="field">
            <label>Behavioral proxies</label>
            <div><input class="ss_cb" type="checkbox" data-val="0.45"> engages in frequent high-risk activities (e.g., extreme sports)</div>
            <div><input class="ss_cb" type="checkbox" data-val="0.35"> reports impulsive sexual decisions</div>
            <div class="help">Checked proxies build a synthetic 0–100 score via weighted sum.</div>
          </div>
        </div>
      </details>

      <div class="field">
        <label>Alcohol / Party Context <span class="tooltip" title="Frequency and context of alcohol intoxication in social settings. Use study coding where available.">[?]</span></label>
        <select id="alcohol_context"><option value="none">No alcohol context</option><option value="light">Light (social drinking)</option><option value="moderate">Moderate (frequent social drinking)</option><option value="heavy">Heavy (regular intoxication in party contexts)</option></select>
        <div class="help">Also toggle the "Party setting" checkbox below if events occur in clubs/frats/bars.</div>
        <div style="margin-top:8px"><input type="checkbox" id="party_setting"> Party/club/fraternity context (adds opportunity multiplier)</div>
      </div>

      <div class="field">
        <label>Peer Norms (check all that apply)</label>
        <div><input class="peer_cb" type="checkbox" data-val="0.02"> peers approve of casual sex</div>
        <div><input class="peer_cb" type="checkbox" data-val="0.02"> peers frequently hook up</div>
        <div><input class="peer_cb" type="checkbox" data-val="0.02"> peers openly discuss casual sex</div>
        <div><input class="peer_cb" type="checkbox" data-val="0.02"> peer group largely single/unattached</div>
        <div class="help">Each box adds up to a cap (default cap 0.08). If source reports a continuous norm scale, normalize to 0–1 and enter in override (below).</div>
        <div style="margin-top:6px"><label>Peer norms override (0–1)</label><input id="peer_override" type="number" min="0" max="1" step="0.01" placeholder="Optional"></div>
      </div>

      <div class="field">
  <label>Country / Cultural permissiveness</label>
  <select id="country_select">
    <option value="US" data-score="0.72">United States</option>
    <option value="MX" data-score="0.60">Mexico</option>
    <option value="CN" data-score="0.45">China</option>
    <option value="IN" data-score="0.50">India</option>
    <option value="PH" data-score="0.55">Philippines</option>
    <option value="VN" data-score="0.48">Vietnam</option>
    <option value="EL" data-score="0.65">Greece</option>
    <option value="KR" data-score="0.53">South Korea</option>
    <option value="CA" data-score="0.70">Canada</option>
    <option value="DO" data-score="0.58">Dominican Republic</option>
    <option value="CU" data-score="0.57">Cuba</option>
    <option value="GU" data-score="0.54">Guatemala</option>
    <option value="CO" data-score="0.61">Colombia</option>
    <option value="HT" data-score="0.50">Haiti</option>
    <option value="JM" data-score="0.59">Jamaica</option>
    <option value="SV" data-score="0.56">El Salvador</option>
    <option value="DE" data-score="0.69">Germany</option>
    <option value="GB" data-score="0.73">United Kingdom</option>
    <option value="IT" data-score="0.71">Italy</option>
    <option value="RU" data-score="0.52">Russia</option>
    <option value="PL" data-score="0.65">Poland</option>
    <option value="FR" data-score="0.75">France</option>
    <option value="IR" data-score="0.40">Iran</option>
    <option value="TH" data-score="0.62">Thailand</option>
    <option value="NG" data-score="0.47">Nigeria</option>
    <option value="ET" data-score="0.44">Ethiopia</option>
    <option value="EG" data-score="0.50">Egypt</option>
    <option value="PK" data-score="0.43">Pakistan</option>
    <option value="MM" data-score="0.42">Myanmar</option>
    <option value="KH" data-score="0.41">Cambodia</option>
    <option value="BD" data-score="0.39">Bangladesh</option>
    <option value="ZA" data-score="0.68">South Africa</option>
    <option value="TR" data-score="0.49">Turkey</option>
    <option value="JP" data-score="0.66">Japan</option>
    <option value="BR" data-score="0.64">Brazil</option>
    <option value="AR" data-score="0.67">Argentina</option>
    <option value="ES" data-score="0.74">Spain</option>
    <option value="PT" data-score="0.72">Portugal</option>
    <option value="IL" data-score="0.70">Israel</option>
    <option value="LB" data-score="0.60">Lebanon</option>
    <option value="SA" data-score="0.36">Saudi Arabia</option>
    <option value="AF" data-score="0.28">Afghanistan</option>
    <option value="NP" data-score="0.38">Nepal</option>
    <option value="LK" data-score="0.46">Sri Lanka</option>
    <option value="MA" data-score="0.48">Morocco</option>
    <option value="AL" data-score="0.58">Albania</option>
    <option value="SE" data-score="0.80">Sweden</option>
    <option value="NO" data-score="0.79">Norway</option>
    <option value="FI" data-score="0.78">Finland</option>
    <option value="MANUAL">-- Manual numeric (0–1) --</option>
  </select>

  <div id="manual_country_div" style="display:none;margin-top:6px">
    <label>Manual country permissiveness (0–1)</label>
    <input id="country_manual" type="number" min="0" max="1" step="0.01" placeholder="0.5">
  </div>

  <div style="margin-top:8px">
    <input type="checkbox" id="urban_toggle">
    <label for="urban_toggle" style="display:inline">Use Urban Adjustment</label>
  </div>

  <div class="help">
    Default country mapping uses ISDP / national SOI means with an optional urban/rural adjustment.
    Manual override allowed.
  </div>
</div>


      <div class="field">
        <label>Religiosity / Conservative background</label>
        <select id="religion"><option value="0">Not highly religious</option><option value="1">Highly religious/conservative sample</option></select>
        <div class="help">Highly religious samples receive a downward modifier (default −0.06).</div>
      </div>

      <details>
        <summary style="font-weight:700">Advanced & Interactions (click to expand)</summary>
        <div class="expander">
          <div class="field">
            <label>Enable small interaction adjustments?</label>
            <select id="interactions"><option value="0">No</option><option value="1">Yes (apply Gender×App & Race×App)</option></select>
            <div class="help">These apply small multiplicative adjustments when both conditions hold (e.g., male & app active).</div>
          </div>
          <div class="field">
            <label>Dating app active?</label>
            <select id="app_use"><option value="0">No / Rare</option><option value="1">Active user</option></select>
          </div>
          <div class="field">
            <label>Editable scales (for advanced users)</label>
            <button id="downloadScales">Download current scales JSON</button>
            <div class="small">Edit scales only if you understand provenance; changes must be documented in methods.</div>
          </div>
        </div>
      </details>

      <div style="display:flex;gap:8px;margin-top:12px;align-items:center">
        <button id="exportBtn" class="exportBtn">Export parameters + score</button>
        <button id="exampleBtn">Load example profiles</button>
      </div>

      <div class="footerNote">Documentation: All default weights derive from a synthesis of meta-analytic summaries (gender effects, SOI‑R, event-level alcohol effects, peer norms, ISDP national averages). See methods supplement for citations.</div>
    </div>

    <div class="vis-wrap">
      <div class="vis-card">
        <div class="scoreCard"><div>Score</div><div id="scoreCard">—</div></div>
        <canvas id="heatmapCanvas"></canvas>
        <div class="legend">Heat: low → high (culture x SOI)</div>
      </div>
    </div>
  </div>

<script>
// ---------------- SCALES (editable block) ----------------
const SCALES = {
  base: 0.30,
  gender: { male: 0.08, female: -0.08, nonbinary: 0.0 },
  soi: { weight: 0.22, min:0, max:9 },
  sensation: { weight: 0.10, min:0, max:100 },
  age: { weight: 0.10, peakMin:20, peakMax:29 },
  alcohol: { weights: { none:0, light:0.15, moderate:0.30, heavy:0.45 }, party_multiplier: 1.08 },
  app: { weight:0.12 },
  peer: { per_check:0.02, cap:0.08 },
  culture: { mapping: { US:0.5, SE:0.8, BR:0.75, JP:0.35 }, weight:0.15 },
  religion: { high: -0.06 },
  race_mods: { none:0, white:0, black:-0.02, asian:-0.02, latino:0 },
  interactions: { gender_app:0.03, race_app:0.03 }
};

// ---------------- Utilities ----------------
function clamp(x,a,b){return Math.max(a,Math.min(b,x));}
function ageKernel(age, peakMin, peakMax){ const min=16, max=99; if(age<=peakMin) return clamp((age-min)/(peakMin-min),0,1); if(age>=peakMax) return clamp((max-age)/(max-peakMax),0,1); return 1.0; }

// ---------------- Read inputs & derive synthetic scores ----------------
function readInputs(){
  const age = parseInt(document.getElementById('age').value) || 25;
  const gender = document.getElementById('gender').value;
  const race = document.getElementById('race').value;
  const soiDirect = parseFloat(document.getElementById('soi_direct').value);
  const soiChecks = Array.from(document.querySelectorAll('.soi_cb')).filter(c=>c.checked).map(c=>parseFloat(c.getAttribute('data-val')));
  const sensationDirect = parseFloat(document.getElementById('sensation_direct').value);
  const ssChecks = Array.from(document.querySelectorAll('.ss_cb')).filter(c=>c.checked).map(c=>parseFloat(c.getAttribute('data-val')));
  const alcoholVal = document.getElementById('alcohol_context').value;
  const partySetting = document.getElementById('party_setting').checked;
  const peerOverride = parseFloat(document.getElementById('peer_override').value);
  const peerChecks = Array.from(document.querySelectorAll('.peer_cb')).filter(c=>c.checked).map(c=>parseFloat(c.getAttribute('data-val')));
  const country = document.getElementById('country_select').value;
  const countryManual = parseFloat(document.getElementById('country_manual').value);
  const religion = parseInt(document.getElementById('religion').value);
  const interactions = document.getElementById('interactions').value === '1';
  const appUse = parseInt(document.getElementById('app_use').value) === 1;

  // SOI derivation: if direct available, use it; else combine checks to synthetic 0-1
  let soiNorm;
  if(!isNaN(soiDirect)){
    soiNorm = clamp((soiDirect - SCALES.soi.min)/(SCALES.soi.max - SCALES.soi.min), 0, 1);
  } else {
    const sumChecks = soiChecks.reduce((a,b)=>a+b,0);
    soiNorm = clamp(sumChecks, 0, 1);
  }

  // Sensation derivation: map to 0-1
  let sensationNorm;
  if(!isNaN(sensationDirect)) sensationNorm = clamp((sensationDirect - SCALES.sensation.min)/(SCALES.sensation.max - SCALES.sensation.min),0,1);
  else {
    const ssum = ssChecks.reduce((a,b)=>a+b,0);
    sensationNorm = clamp(ssum,0,1);
  }

  // Peer norms
  let peerNorm;
  if(!isNaN(peerOverride)) peerNorm = clamp(peerOverride,0,1);
  else { const pSum = peerChecks.reduce((a,b)=>a+b,0); peerNorm = clamp(pSum,0,SCALES.peer.cap); }

  // Culture value
  let cultureVal;
  if(country === 'MANUAL') cultureVal = clamp(countryManual || 0.5,0,1);
  else cultureVal = SCALES.culture.mapping[country] || 0.5;

  return { age, gender, race, soiNorm, sensationNorm, alcoholVal, partySetting, peerNorm, cultureVal, religion, interactions, appUse };
}

// ---------------- Scoring function ----------------
function computeScore(inputs){
  const base = SCALES.base;
  const g = SCALES.gender[inputs.gender] || 0;
  const soiContrib = SCALES.soi.weight * inputs.soiNorm; // up to 0.22
  const sensContrib = SCALES.sensation.weight * inputs.sensationNorm; // up to 0.10
  const ageC = ageKernel(inputs.age, SCALES.age.peakMin, SCALES.age.peakMax) * SCALES.age.weight; // up to 0.10
  const alcW = SCALES.alcohol.weights[ inputs.alcoholVal ] || 0;
  let alcContrib = alcW;
  if(inputs.partySetting) alcContrib *= SCALES.alcohol.party_multiplier; // slight multiplier
  const appContrib = inputs.appUse ? SCALES.app.weight : 0;
  const peerContrib = inputs.peerNorm; // already in 0-0.08
  const cultContrib = SCALES.culture.weight * inputs.cultureVal; // up to 0.15
  const raceAdj = SCALES.race_mods[inputs.race] || 0;
  const religAdj = inputs.religion ? SCALES.religion.high : 0;

  let raw = base + g + soiContrib + sensContrib + ageC + alcContrib + appContrib + peerContrib + cultContrib + raceAdj + religAdj;

  // optional interactions (small multiplicative adjustments)
  if(inputs.interactions && inputs.appUse){
    if(inputs.gender === 'male') raw *= (1 + SCALES.interactions.gender_app);
    if(inputs.race !== 'none' && inputs.race !== 'white') raw *= (1 + SCALES.interactions.race_app);
  }

  const clamped = clamp(raw, 0, 1);
  return { raw, clamped, percent: Math.round(clamped*1000)/10 };
}

// ---------------- Heatmap rendering (canvas 2D) ----------------
const canvas = document.getElementById('heatmapCanvas');
const ctx = canvas.getContext('2d');
let heatmapImage = null; // cache image data to avoid re-computing on every frame
let lastSize = {w:0,h:0};

function resizeCanvas(){
  const rect = document.querySelector('.vis-card').getBoundingClientRect();
  canvas.width = Math.max(200, Math.floor(rect.width - 24));
  canvas.height = Math.max(200, Math.floor(rect.height - 80));
  heatmapImage = null; // force regeneration
  render();
}
window.addEventListener('resize', resizeCanvas);

function generateHeatmap(){
  const w = canvas.width, h = canvas.height;
  const img = ctx.createImageData(w, h);
  // iterate pixels and compute probability for baseline hypothetical at that culture/SOI
  for(let y=0;y<h;y++){
    const soiVal = 1 - y/(h-1); // top=1, bottom=0
    for(let x=0;x<w;x++){
      const cultureVal = x/(w-1);
      const hypothetical = {
        age:25, gender:'male', race:'none', soiNorm:soiVal, sensationNorm:0.5,
        alcoholVal:'none', partySetting:false, peerNorm:0, cultureVal:cultureVal, religion:0, interactions:false, appUse:false
      };
      const p = computeScore(hypothetical).clamped;
      // color gradient blue->green->yellow->red
      const r = Math.round(255 * Math.min(1, Math.max(0, (p - 0.5)*2 )));
      const g = Math.round(255 * (1 - Math.abs(p - 0.5)*2));
      const b = Math.round(255 * Math.min(1, Math.max(0, (0.5 - p)*2)));
      const idx = (y*w + x)*4;
      img.data[idx] = r; img.data[idx+1] = g; img.data[idx+2] = b; img.data[idx+3] = 255;
    }
  }
  heatmapImage = img;
}

function render(){
  // regenerate heatmap image if needed
  if(!heatmapImage || lastSize.w !== canvas.width || lastSize.h !== canvas.height){
    generateHeatmap();
    lastSize.w = canvas.width; lastSize.h = canvas.height;
  }
  ctx.putImageData(heatmapImage, 0, 0);

  // draw axes labels
  ctx.fillStyle = 'rgba(255,255,255,0.9)'; ctx.font = '13px Inter, Arial';
  ctx.fillText('Culture →', canvas.width - 100, canvas.height - 8);
  ctx.save(); ctx.translate(10,18); ctx.rotate(-Math.PI/2); ctx.fillText('SOI →', 0,0); ctx.restore();

  // draw dot representing current inputs
  const inputs = readInputs();
  const x = Math.round(inputs.cultureVal * (canvas.width - 1));
  const y = Math.round((1 - inputs.soiNorm) * (canvas.height - 1));
  ctx.beginPath(); ctx.arc(x, y, Math.max(6, Math.min(12, canvas.width * 0.02)), 0, Math.PI*2);
  // dot color reflects score intensity
  const score = computeScore(inputs).clamped;
  const dotR = Math.round(255 * Math.min(1, Math.max(0, (score - 0.5)*2 )));
  const dotG = Math.round(255 * (1 - Math.abs(score - 0.5)*2));
  const dotB = Math.round(255 * Math.min(1, Math.max(0, (0.5 - score)*2)));
  ctx.fillStyle = `rgb(${dotR},${dotG},${dotB})`;
  ctx.fill(); ctx.lineWidth = 2; ctx.strokeStyle = '#000'; ctx.stroke();

  // update score card text
  document.getElementById('scoreCard').textContent = computeScore(inputs).percent + '%';
}

// ---------------- Wire UI events ----------------
function attach(){
  document.getElementById('country_select').addEventListener('change', (e)=>{ document.getElementById('manual_country_div').style.display = e.target.value==='MANUAL' ? 'block' : 'none'; update(); });
  Array.from(document.querySelectorAll('#controls input, #controls select')).forEach(el=>el.addEventListener('input', update));

  document.getElementById('downloadScales').addEventListener('click', ()=>{ const blob=new Blob([JSON.stringify(SCALES,null,2)],{type:'application/json'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='scales.json'; a.click(); URL.revokeObjectURL(url); });

  document.getElementById('exportBtn').addEventListener('click', ()=>{ const inputs=readInputs(); const result=computeScore(inputs); const out={inputs,result,scales:SCALES}; const blob=new Blob([JSON.stringify(out,null,2)],{type:'application/json'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=`meta_explorer_export_${Date.now()}.json`; a.click(); URL.revokeObjectURL(url); });

  document.getElementById('exampleBtn').addEventListener('click', loadExamples);
}

function update(){ render(); }

// ---------------- Example profiles ----------------
function loadExamples(){
  const s = {age:21,gender:'male',race:'white',soiNorm:0.8,sensationNorm:0.7,alcoholVal:'moderate',partySetting:true,peerNorm:0.06,cultureVal:0.5,religion:0,interactions:true,appUse:true};
  document.getElementById('age').value = s.age; document.getElementById('gender').value=s.gender; document.getElementById('race').value=s.race; document.getElementById('soi_direct').value = Math.round(s.soiNorm*9*10)/10; document.getElementById('sensation_direct').value=Math.round(s.sensationNorm*100); document.getElementById('country_select').value='US'; document.getElementById('peer_override').value = '';
  update();
}

// initial setup
attach(); resizeCanvas();

 // --- NEW COUNTRY + URBAN TOGGLE HANDLING ---
  const countrySelect = document.getElementById('country_select');
  const manualCountryDiv = document.getElementById('manual_country_div');
  const manualCountryInput = document.getElementById('country_manual');
  const urbanToggle = document.getElementById('urban_toggle');

  function getCountryScore() {
    let baseScore = 0;

    if (countrySelect.value === "MANUAL") {
      baseScore = parseFloat(manualCountryInput.value) || 0;
    } else {
      const selectedOption = countrySelect.options[countrySelect.selectedIndex];
      baseScore = parseFloat(selectedOption.getAttribute('data-score')) || 0;
    }

    // Apply urban adjustment
    if (urbanToggle.checked) {
      baseScore = Math.min(1, baseScore + 0.05); // cap at 1
    }

    return baseScore;
  }

  // Show/hide manual input
  countrySelect.addEventListener('change', () => {
    manualCountryDiv.style.display =
      countrySelect.value === "MANUAL" ? "block" : "none";
    updateScore();
  });

  manualCountryInput.addEventListener('input', updateScore);
  urbanToggle.addEventListener('change', updateScore);
</script>
</body>
</html>
